## 시작 -> 실행 -> ISE
## login-azaccount
## Azure Backup을 처음 사용하는 경우 다음과 같이 Register-AzResourceProvider를 사용하여 구독에서 Azure Recovery Service 공급자를 등록해야 한다.(이미 생성되어 있으면 pass)
Register-AzResourceProvider -ProviderNamespace "Microsoft.RecoveryServices"

0. Recovery Services 자격 증명 모음 만들기(이미 생성되어 있으면 pass)
New-AzRecoveryServicesVault `
    -ResourceGroupName "ISCREAM" `
    -Name "hiclass-backup-recovery" `
-Location "WestEurope"

1. 자격 증명 모음 컨텍스트를 설정.
Get-AzRecoveryServicesVault `
    -Name "hiclass-backup-recovery" | Set-AzRecoveryServicesVaultContext

2. 자격 증명 모음의 스토리지 중복 구성(LRS/GRS)을 변경합니다.(로컬/글로벌) => 여기서는 로컬
Get-AzRecoveryServicesVault `
    -Name "hiclass-backup-recovery" | Set-AzRecoveryServicesBackupProperty -BackupStorageRedundancy LocallyRedundant

### Azure VM에 백업 사용

3. 백업 기본 정책 설정(없으면 DefaultPolicy)
$policy = Get-AzRecoveryServicesBackupProtectionPolicy -Name "apibackup"

4. VM 백업을 사용하도록 설정 -> 정책, 리소스 그룹 및 VM 이름을 지정
Enable-AzRecoveryServicesBackupProtection `
    -ResourceGroupName "ISCREAM" `
    -Name "Hi-Class-eletter-01" `
    -Policy $policy

5. 컨테이너를 지정하고, VM 정보를 가져오고, 백업을 실행
$backupcontainer = Get-AzRecoveryServicesBackupContainer `
    -ContainerType "AzureVM" `
    -FriendlyName "Hi-Class-eletter-01"

$item = Get-AzRecoveryServicesBackupItem `
    -Container $backupcontainer `
    -WorkloadType "AzureVM"

Backup-AzRecoveryServicesBackupItem -Item $item

4. 백업 작업 모니터링
Get-AzRecoveryservicesBackupJob
